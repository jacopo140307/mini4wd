<!doctype html>
<html lang="it">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>Mini4WD Advisor — Demo Grafica (Cartoon)</title>
<style>
  :root{
    --bg:#0b1220; --panel:#0f172a; --ink:#e5edff; --muted:#9fb3ff;
    --accent:#7c3aed; --accent2:#22d3ee; --line:#1e293b;
    --chassis:#111827; --chassis-grad1:#1f2937; --chassis-grad2:#0f172a;
    --rubber:#0a0a0a; --rim:#b6c2ff;
    --plate:#22d3ee; --roller:#00e5a8; --damper:#ffd166; --brake:#ff5370; --weight:#b8ff5a
  }
  html,body{margin:0;background:linear-gradient(180deg,#0a0f1e, #0b1220 60%, #0a0f1e); color:var(--ink); font-family:Inter, ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto}
  .wrap{max-width:1200px;margin:0 auto;padding:18px}
  h1{margin:6px 0 14px;font-size:clamp(22px,3.2vw,30px); letter-spacing:.3px}
  .row{display:flex;gap:12px;align-items:center;flex-wrap:wrap}
  .panel{background:linear-gradient(180deg,#0f172a,#0b1426); border:1px solid #1b2640; border-radius:16px; box-shadow:0 20px 60px rgba(40,80,200,.25)}
  .panel h2{margin:0;padding:14px 16px;border-bottom:1px solid var(--line);font-size:16px;color:#cfe1ff}
  .panel .body{padding:14px 16px}
  .controls .group{display:flex;gap:10px;align-items:center;flex-wrap:wrap;margin:8px 0}
  .chip{border:1px solid #24304e;background:#0d1530;padding:8px 11px;border-radius:12px;cursor:pointer;color:#cfe1ff}
  .chip.active{border-color:var(--accent2); box-shadow:0 0 0 2px rgba(34,211,238,.15) inset; color:#eaf3ff}
  .btn{border:1px solid #24304e;background:#0d1530;padding:10px 13px;border-radius:12px;cursor:pointer;color:#dfe8ff}
  .btn.primary{background:linear-gradient(90deg,#7c3aed,#22d3ee); color:#fff; border:0; box-shadow:0 8px 20px rgba(124,58,237,.35)}
  .muted{color:var(--muted);font-size:12px}
  .grid{display:grid;gap:14px}
  @media(min-width:1050px){.g2{grid-template-columns: 360px 1fr}}
  canvas{width:100%;height:auto;background:radial-gradient(1200px 520px at 50% 30%, #0d162d 0%, #0b1220 70%); border:1px solid #1b2640; border-radius:16px}
  .legend{display:grid;grid-template-columns:repeat(6,minmax(140px,1fr));gap:10px}
  .legend .k{background:#101a36;border:1px solid #223258;border-radius:12px;padding:10px;font-size:12px;color:#cfe1ff}
  .k b{display:block;margin-bottom:6px;color:#fff}
</style>
</head>
<body>
<div class="wrap">
  <div class="row" style="justify-content:space-between">
    <h1>Mini4WD Advisor — Demo Grafica <span style="color:#a78bfa">Cartoon</span></h1>
    <div class="muted">Bozza interattiva: vista Sopra/Sotto, rotazione, livelli, stile “configuratore”</div>
  </div>

  <div class="grid g2">
    <!-- Controlli -->
    <div class="panel">
      <h2>Controlli</h2>
      <div class="body controls">
        <div class="group">
          <span class="muted">Vista:</span>
          <button class="chip active" data-view="top">Sopra</button>
          <button class="chip" data-view="bottom">Sotto</button>
        </div>

        <div class="group">
          <span class="muted">Rotazione:</span>
          <input id="rot" type="range" min="0" max="360" value="0">
          <span id="rotLabel" class="muted">0°</span>
        </div>

        <div class="group">
          <span class="muted">Scala:</span>
          <input id="scale" type="range" min="0.75" max="1.35" step="0.05" value="1">
          <span id="scaleLabel" class="muted">100%</span>
        </div>

        <div class="group">
          <span class="muted">Livelli:</span>
          <label><input type="checkbox" class="layer" data-layer="grid" checked> Griglia</label>
          <label><input type="checkbox" class="layer" data-layer="plates" checked> Piastre</label>
          <label><input type="checkbox" class="layer" data-layer="rollers" checked> Roller</label>
          <label><input type="checkbox" class="layer" data-layer="dampers" checked> Damper</label>
          <label><input type="checkbox" class="layer" data-layer="brakes" checked> Freni</label>
          <label><input type="checkbox" class="layer" data-layer="weights" checked> Pesi</label>
          <label><input type="checkbox" class="layer" data-layer="labels" checked> Etichette</label>
        </div>

        <div class="group">
          <button id="reset" class="btn">Reset vista</button>
          <button id="export" class="btn primary">Esporta PNG</button>
        </div>

        <div class="group">
          <div class="muted">Riferimenti (Super‑II): lunghezza ~156 mm • passo ~80 mm • larghezza ~90 mm</div>
        </div>
      </div>
    </div>

    <!-- Canvas -->
    <div class="panel">
      <h2>Configuratore (bozza)</h2>
      <div class="body">
        <canvas id="cv" width="1200" height="560" aria-label="Schema Mini4WD"></canvas>
        <div class="muted" style="margin-top:8px">Le posizioni sono indicative ma coerenti. Per il matching in mm useremo i dati del catalogo ufficiale.</div>
      </div>
    </div>
  </div>

  <!-- Legenda -->
  <div class="panel" style="margin-top:12px">
    <h2>Legenda</h2>
    <div class="body legend">
      <div class="k"><b>Chassis</b> scocca e ruote (shading)</div>
      <div class="k"><b>Piastre</b> FRP/Carbonio (ciano)</div>
      <div class="k"><b>Roller</b> 13/19 mm (verde acqua)</div>
      <div class="k"><b>Damper</b> 8/12 g (giallo)</div>
      <div class="k"><b>Freni</b> sponge/basette (magenta)</div>
      <div class="k"><b>Pesi</b> ottone/piombo (lime)</div>
    </div>
  </div>
</div>

<script>
/* ===== Base dimensioni (Super‑II) ===== */
const BASE = { length:156, width:90, wheelbase:80 };
const C = {
  ink:getCss('--ink'), line:getCss('--line'), muted:getCss('--muted'),
  plate:getCss('--plate'), roller:getCss('--roller'), damper:getCss('--damper'),
  brake:getCss('--brake'), weight:getCss('--weight'),
  chassis:getCss('--chassis'), c1:getCss('--chassis-grad1'), c2:getCss('--chassis-grad2'),
  rubber:getCss('--rubber'), rim:getCss('--rim')
};
function getCss(v){ return getComputedStyle(document.documentElement).getPropertyValue(v).trim(); }

const cv = document.getElementById('cv'); const cx = cv.getContext('2d');
let state = { view:'top', rot:0, scale:1, layers:{grid:true,plates:true,rollers:true,dampers:true,brakes:true,weights:true,labels:true} };

function center(){ return {cx:cv.width/2, cy:cv.height/2}; }
function mm2px(mm){ const usable=cv.width*0.8; const k=(usable/180)*state.scale; return mm*k; }

function drawGlowCircle(x,y,r,fill){
  const g=cx.createRadialGradient(x,y, r*0.2, x,y, r);
  g.addColorStop(0, fill); g.addColorStop(1, 'transparent');
  cx.save(); cx.globalAlpha=0.45; cx.fillStyle=g; cx.beginPath(); cx.arc(x,y,r,0,Math.PI*2); cx.fill(); cx.restore();
}

function drawGrid(){
  const {cx:CX,cy:CY}=center(); const k=mm2px(1); const exX=cv.width*0.44, exY=cv.height*0.38;
  cx.save(); cx.translate(CX,CY); cx.rotate(state.rot*Math.PI/180);
  // bagliore centrale
  drawGlowCircle(0,0,exX*0.9,'rgba(124,58,237,.25)');
  cx.strokeStyle='rgba(34,211,238,.25)'; cx.lineWidth=1;
  for(let i=-200;i<=200;i+=10){
    cx.beginPath(); cx.moveTo(-exX, i*k); cx.lineTo(exX, i*k); cx.stroke();
    cx.beginPath(); cx.moveTo(i*k, -exY); cx.lineTo(i*k, exY); cx.stroke();
  }
  cx.strokeStyle='rgba(124,58,237,.55)'; cx.lineWidth=1.4;
  cx.beginPath(); cx.moveTo(-exX,0); cx.lineTo(exX,0); cx.stroke();
  cx.beginPath(); cx.moveTo(0,-exY); cx.lineTo(0,exY); cx.stroke();
  cx.restore();
}

function roundedRect(x,y,w,h,r){ cx.beginPath(); cx.moveTo(x+r,y); cx.arcTo(x+w,y,x+w,y+h,r); cx.arcTo(x+w,y+h,x,y+h,r); cx.arcTo(x,y+h,x,y,r); cx.arcTo(x,y,x+w,y,r); cx.closePath(); }

function drawChassis(){
  const {cx:CX,cy:CY}=center(); const L=mm2px(BASE.length), W=mm2px(BASE.width), WB=mm2px(BASE.wheelbase);
  const bodyL=L*0.78, bodyW=W, noseL=L*0.11, tailL=L*0.11, wheelDia=mm2px(26), wheelW=mm2px(9.5), ax=WB/2;
  cx.save(); cx.translate(CX,CY); cx.rotate(state.rot*Math.PI/180);

  // ruote con cerchio
  cx.fillStyle=C.rubber;
  const wheels=[[-ax,-bodyW/2-wheelW/2],[ -ax, bodyW/2+wheelW/2],[ax,-bodyW/2-wheelW/2],[ax, bodyW/2+wheelW/2]];
  wheels.forEach(([x,y])=>{
    cx.beginPath(); cx.arc(x,y,wheelDia/2,0,Math.PI*2); cx.fill();
    cx.fillStyle=C.rim; cx.beginPath(); cx.arc(x,y,wheelDia/2.8,0,Math.PI*2); cx.fill(); cx.fillStyle=C.rubber;
  });

  // scocca cartoon (gradiente + bordo brillante)
  const x0=-bodyL/2, y0=-bodyW/2;
  const grd=cx.createLinearGradient(x0,0,x0+bodyL,0); grd.addColorStop(0,C.c1); grd.addColorStop(1,C.c2);
  cx.fillStyle=grd; cx.strokeStyle='rgba(124,58,237,.8)'; cx.lineWidth=2.2;
  roundedRect(x0,y0,bodyL,bodyW, mm2px(8)); cx.fill(); cx.stroke();

  // muso / coda
  cx.beginPath(); cx.moveTo(x0, y0); cx.lineTo(x0 - noseL, 0); cx.lineTo(x0, y0 + bodyW); cx.closePath(); cx.fill(); cx.stroke();
  cx.beginPath(); cx.moveTo(x0 + bodyL, y0); cx.lineTo(x0 + bodyL + tailL, 0); cx.lineTo(x0 + bodyL, y0 + bodyW); cx.closePath(); cx.fill(); cx.stroke();

  // linee decorative
  cx.strokeStyle='rgba(34,211,238,.65)'; cx.lineWidth=1.5;
  cx.beginPath(); cx.moveTo(x0+mm2px(10), y0+mm2px(10)); cx.lineTo(x0+bodyL-mm2px(10), y0+mm2px(10)); cx.stroke();
  cx.beginPath(); cx.moveTo(x0+mm2px(10), y0+bodyW-mm2px(10)); cx.lineTo(x0+bodyL-mm2px(10), y0+bodyW-mm2px(10)); cx.stroke();

  // etichetta
  if(state.layers.labels){ cx.fillStyle=C.muted; cx.font='12px Inter, system-ui'; cx.fillText(`Vista ${state.view==='top'?'Sopra':'Sotto'}`, x0, y0 - mm2px(12)); }

  cx.restore();
}

function drawModules(){
  const {cx:CX,cy:CY}=center(); const L=mm2px(BASE.length), W=mm2px(BASE.width), WB=mm2px(BASE.wheelbase);
  const bodyL=L*0.78, x0=-bodyL/2, ax=WB/2;

  cx.save(); cx.translate(CX,CY); cx.rotate(state.rot*Math.PI/180);

  // Piastre (bagliore + barra)
  if(state.layers.plates){
    cx.save();
    cx.shadowColor='rgba(34,211,238,.6)'; cx.shadowBlur=16; cx.fillStyle=C.plate; 
    const pw=mm2px(14), pl=mm2px(60);
    roundedRect(x0 - mm2px(8) - pl, -pw/2, pl, pw, mm2px(4)); cx.globalAlpha=.9; cx.fill(); cx.globalAlpha=1;
    roundedRect(x0 + bodyL + mm2px(8), -pw/2, pl, pw, mm2px(4)); cx.fill();
    cx.restore();
  }

  // Roller (glow)
  if(state.layers.rollers){
    cx.fillStyle=C.roller;
    const r13=mm2px(6.5), r19=mm2px(9.5);
    const fX=x0 - mm2px(8) - mm2px(60) + mm2px(6);
    const rX=x0 + bodyL + mm2px(8) + mm2px(60) - mm2px(6);
    // front 19
    drawGlowCircle(fX, -W*0.36, r19*1.6, 'rgba(0,229,168,.45)'); cx.beginPath(); cx.arc(fX, -W*0.36, r19, 0, Math.PI*2); cx.fill();
    drawGlowCircle(fX,  W*0.36, r19*1.6, 'rgba(0,229,168,.45)'); cx.beginPath(); cx.arc(fX,  W*0.36, r19, 0, Math.PI*2); cx.fill();
    // rear 13
    drawGlowCircle(rX, -W*0.36, r13*1.6, 'rgba(0,229,168,.45)'); cx.beginPath(); cx.arc(rX, -W*0.36, r13, 0, Math.PI*2); cx.fill();
    drawGlowCircle(rX,  W*0.36, r13*1.6, 'rgba(0,229,168,.45)'); cx.beginPath(); cx.arc(rX,  W*0.36, r13, 0, Math.PI*2); cx.fill();
  }

  // Damper
  if(state.layers.dampers){
    cx.fillStyle=C.damper;
    const dR=mm2px(6);
    drawGlowCircle(x0 + bodyL*0.60, -W*0.15, dR*2.0, 'rgba(255,209,102,.35)');
    drawGlowCircle(x0 + bodyL*0.60,  W*0.15, dR*2.0, 'rgba(255,209,102,.35)');
    cx.beginPath(); cx.arc(x0 + bodyL*0.60, -W*0.15, dR, 0, Math.PI*2); cx.fill();
    cx.beginPath(); cx.arc(x0 + bodyL*0.60,  W*0.15, dR, 0, Math.PI*2); cx.fill();
  }

  // Freni (solo vista sotto)
  if(state.layers.brakes && state.view==='bottom'){
    cx.fillStyle=C.brake;
    drawGlowCircle(x0 + bodyL + mm2px(16), -mm2px(8), mm2px(10), 'rgba(255,83,112,.35)');
    cx.fillRect(x0 + bodyL + mm2px(6), -mm2px(8), mm2px(32), mm2px(3));
    drawGlowCircle(x0 + bodyL + mm2px(16),  mm2px(6), mm2px(10), 'rgba(255,83,112,.35)');
    cx.fillRect(x0 + bodyL + mm2px(6),  mm2px(6), mm2px(32), mm2px(3));
  }

  // Pesi
  if(state.layers.weights){
    cx.fillStyle=C.weight;
    const p=mm2px(12), t=mm2px(4);
    drawGlowCircle(x0 + bodyL*0.25, -mm2px(5), p, 'rgba(184,255,90,.25)');
    cx.fillRect(x0 + bodyL*0.25, -mm2px(6), p, t);
    drawGlowCircle(x0 + bodyL*0.35, -mm2px(5), p, 'rgba(184,255,90,.25)');
    cx.fillRect(x0 + bodyL*0.35, -mm2px(6), p, t);
    drawGlowCircle(x0 + bodyL*0.46,  mm2px(3),  p, 'rgba(184,255,90,.25)');
    cx.fillRect(x0 + bodyL*0.46,  mm2px(2),  p, t);
  }

  // Etichette
  if(state.layers.labels){
    cx.fillStyle=C.muted; cx.font='12px Inter, system-ui';
    cx.fillText('Piastra front', x0 - mm2px(70), -mm2px(16));
    cx.fillText('Piastra rear',  x0 + bodyL + mm2px(10), -mm2px(16));
    cx.fillText('Roller 19mm',   x0 - mm2px(58), -W*0.36 - mm2px(12));
    cx.fillText('Roller 13mm',   x0 + bodyL + mm2px(36), -W*0.36 - mm2px(12));
    if(state.view==='bottom'){ cx.fillText('Freni (sotto)', x0 + bodyL + mm2px(10), -mm2px(16)); }
    cx.fillText('Damper 8/12g',  x0 + bodyL*0.60 + mm2px(8), -W*0.15);
    cx.fillText('Pesi (CG)',     x0 + bodyL*0.33, mm2px(20));
  }

  cx.restore();
}

function render(){
  cx.clearRect(0,0,cv.width,cv.height);
  if(state.layers.grid) drawGrid();
  drawChassis();
  drawModules();
}

// UI
document.querySelectorAll('.chip[data-view]').forEach(b=>{
  b.onclick=()=>{ document.querySelectorAll('.chip[data-view]').forEach(x=>x.classList.remove('active'));
    b.classList.add('active'); state.view=b.dataset.view; render(); };
});
document.getElementById('rot').oninput=e=>{ state.rot=+e.target.value; document.getElementById('rotLabel').textContent=state.rot+'°'; render(); };
document.getElementById('scale').oninput=e=>{ state.scale=+e.target.value; document.getElementById('scaleLabel').textContent=Math.round(state.scale*100)+'%'; render(); };
document.querySelectorAll('.layer').forEach(ch=>{ ch.onchange=()=>{ state.layers[ch.dataset.layer]=ch.checked; render(); }; });
document.getElementById('reset').onclick=()=>{ state.rot=0; state.scale=1; rot.value=0; scale.value=1; rotLabel.textContent='0°'; scaleLabel.textContent='100%'; render(); };
document.getElementById('export').onclick=()=>{ const a=document.createElement('a'); a.download='mini4wd_demo_cartoon.png'; a.href=cv.toDataURL('image/png'); a.click(); };

// first render
render();
</script>
</body>
</html>
