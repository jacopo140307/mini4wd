<!doctype html>
<html lang="it">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>Mini4WD Advisor — Demo Grafica (Tecnica)</title>
<style>
  :root{--ink:#0f172a;--muted:#64748b;--line:#e2e8f0;--accent:#2563eb;--ok:#10b981;--warn:#f59e0b;--danger:#ef4444}
  html,body{margin:0;background:#f7f9fc;color:var(--ink);font-family:system-ui,-apple-system,Segoe UI,Roboto,Ubuntu}
  .wrap{max-width:1200px;margin:0 auto;padding:16px}
  h1{margin:6px 0 12px;font-size:clamp(20px,3vw,28px)}
  .row{display:flex;gap:12px;align-items:center;flex-wrap:wrap}
  .panel{background:#fff;border:1px solid var(--line);border-radius:12px;box-shadow:0 8px 20px rgba(2,6,23,.05)}
  .panel h2{margin:0;padding:12px 16px;border-bottom:1px solid var(--line);font-size:16px}
  .panel .body{padding:12px 16px}
  .controls .group{display:flex;gap:8px;align-items:center;flex-wrap:wrap;margin:6px 0}
  .chip{border:1px solid var(--line);background:#fff;padding:7px 10px;border-radius:10px;cursor:pointer}
  .chip.active{border-color:var(--accent);color:var(--accent);font-weight:700}
  .btn{border:1px solid var(--line);background:#fff;padding:9px 12px;border-radius:10px;cursor:pointer}
  .btn.primary{background:var(--accent);color:#fff;border-color:var(--accent)}
  .muted{color:var(--muted);font-size:12px}
  .grid{display:grid;gap:12px}
  @media(min-width:1000px){.g2{grid-template-columns: 360px 1fr}}
  canvas{width:100%;height:auto;background:#fff;border:1px solid var(--line);border-radius:12px}
  .legend{display:grid;grid-template-columns:repeat(6,minmax(120px,1fr));gap:8px}
  .legend .k{background:#fff;border:1px solid var(--line);border-radius:10px;padding:8px;font-size:12px}
  .k b{display:block;margin-bottom:4px}
</style>
</head>
<body>
<div class="wrap">
  <div class="row" style="justify-content:space-between">
    <h1>Mini4WD Advisor — Demo Grafica (Tecnica)</h1>
    <div class="muted">Bozza interattiva: vista Sopra/Sotto, rotazione, griglia mm, componenti base</div>
  </div>

  <div class="grid g2">
    <!-- Pannello controlli -->
    <div class="panel">
      <h2>Controlli</h2>
      <div class="body controls">
        <div class="group">
          <span class="muted">Vista:</span>
          <button class="chip active" data-view="top">Sopra</button>
          <button class="chip" data-view="bottom">Sotto</button>
        </div>

        <div class="group">
          <span class="muted">Rotazione:</span>
          <input id="rot" type="range" min="0" max="360" value="0">
          <span id="rotLabel" class="muted">0°</span>
        </div>

        <div class="group">
          <span class="muted">Scala disegno:</span>
          <input id="scale" type="range" min="0.7" max="1.3" step="0.05" value="1">
          <span id="scaleLabel" class="muted">100%</span>
        </div>

        <div class="group">
          <span class="muted">Livelli:</span>
          <label><input type="checkbox" class="layer" data-layer="grid" checked> Griglia mm</label>
          <label><input type="checkbox" class="layer" data-layer="plates" checked> Piastre</label>
          <label><input type="checkbox" class="layer" data-layer="rollers" checked> Roller</label>
          <label><input type="checkbox" class="layer" data-layer="dampers" checked> Damper</label>
          <label><input type="checkbox" class="layer" data-layer="brakes" checked> Freni</label>
          <label><input type="checkbox" class="layer" data-layer="weights" checked> Pesi</label>
          <label><input type="checkbox" class="layer" data-layer="labels" checked> Etichette</label>
        </div>

        <div class="group">
          <button id="reset" class="btn">Reset vista</button>
          <button id="export" class="btn primary">Esporta PNG</button>
        </div>

        <div class="group">
          <div class="muted">Dimensioni riferimento (Super‑II):</div>
          <ul class="muted" style="margin:4px 0 0 16px;line-height:1.6">
            <li>Lunghezza telaio ~156 mm</li>
            <li>Passo ruote ~80 mm</li>
            <li>Larghezza base ~90 mm</li>
          </ul>
        </div>
      </div>
    </div>

    <!-- Canvas -->
    <div class="panel">
      <h2>Schema tecnico (bozza)</h2>
      <div class="body">
        <canvas id="cv" width="1100" height="520" aria-label="Schema Mini4WD"></canvas>
        <div class="muted" style="margin-top:8px">⚠️ Bozza: proporzioni vicine al reale, non definitive. Servono i dati ufficiali del catalogo per la calibrazione fine in mm.</div>
      </div>
    </div>
  </div>

  <!-- Legenda -->
  <div class="panel" style="margin-top:12px">
    <h2>Legenda</h2>
    <div class="body legend">
      <div class="k"><b>Chassis</b> profilo scocca e ruote</div>
      <div class="k"><b>Piastre</b> front/rear FRP/Carbonio (azzurro tenue)</div>
      <div class="k"><b>Roller</b> 13/19 mm (blu acceso)</div>
      <div class="k"><b>Damper</b> masse 8/12 g (giallo)</div>
      <div class="k"><b>Freni</b> sponge/basette (rosso)</div>
      <div class="k"><b>Pesi</b> piombi/ottone (verde)</div>
    </div>
  </div>
</div>

<script>
/* ====== Parametri base (Super‑II) ====== */
const BASE = {
  length: 156,   // mm
  width: 90,     // mm scocca (senza roller)
  wheelbase: 80, // mm
  // scala canvas: quanti px per mm (adattata dinamicamente)
};
const COLORS = {
  ink:"#0f172a", line:"#e2e8f0", muted:"#94a3b8",
  plate:"#76a6ff", roller:"#1e90ff", damper:"#f59e0b",
  brake:"#ef4444", weight:"#10b981", chassis:"#334155", rubber:"#111827"
};

const cv = document.getElementById('cv');
const cx = cv.getContext('2d');
let state = {
  view: 'top',
  rot: 0,
  scale: 1,
  layers: {grid:true, plates:true, rollers:true, dampers:true, brakes:true, weights:true, labels:true}
};

// coordinate helper (centro canvas)
function center(){ return {cx: cv.width/2, cy: cv.height/2}; }
function mm2px(mm){ // scala: 1 mm = k px
  // scalatura dinamica per far entrare ~180 mm (lunghezza + margine) nel canvas
  const usable = cv.width*0.8;
  const k = (usable / 180) * state.scale;
  return mm * k;
}
function drawGrid(){
  const {cx:CX, cy:CY} = center();
  const k = mm2px(1);
  const extent = {x: cv.width*0.45, y: cv.height*0.40};
  cx.save();
  cx.translate(CX, CY);
  cx.rotate(state.rot*Math.PI/180);
  cx.strokeStyle = COLORS.line;
  cx.lineWidth = 1;
  // griglia ogni 10 mm
  for(let i=-200;i<=200;i+=10){
    cx.beginPath(); cx.moveTo(-extent.x, i*k); cx.lineTo(extent.x, i*k); cx.stroke();
    cx.beginPath(); cx.moveTo(i*k, -extent.y); cx.lineTo(i*k, extent.y); cx.stroke();
  }
  // assi
  cx.strokeStyle = COLORS.muted;
  cx.lineWidth = 1.5;
  cx.beginPath(); cx.moveTo(-extent.x,0); cx.lineTo(extent.x,0); cx.stroke();
  cx.beginPath(); cx.moveTo(0,-extent.y); cx.lineTo(0,extent.y); cx.stroke();
  // tacche mm vicino al bordo
  cx.fillStyle = COLORS.muted;
  cx.font = '12px system-ui';
  for(let i=-150;i<=150;i+=30){
    cx.fillText(`${i} mm`, i*k-16, -extent.y-6);
  }
  cx.restore();
}

function roundedRect(x,y,w,h,r){
  cx.beginPath();
  cx.moveTo(x+r,y);
  cx.arcTo(x+w,y,x+w,y+h,r);
  cx.arcTo(x+w,y+h,x,y+h,r);
  cx.arcTo(x,y+h,x,y,r);
  cx.arcTo(x,y,x+w,y,r);
  cx.closePath();
}
function drawChassis(){
  const {cx:CX, cy:CY} = center();
  const L = mm2px(BASE.length);
  const W = mm2px(BASE.width);
  const WB = mm2px(BASE.wheelbase);

  const bodyW = W;              // larghezza scocca
  const bodyL = L * 0.78;       // lunghezza visiva scocca
  const noseL = L * 0.11;       // “muso” anteriore
  const tailL = L * 0.11;       // coda posteriore
  const wheelDia = mm2px(26);   // ruote 26 mm
  const wheelW = mm2px(10);     // spessore ruota
  const axOffset = WB/2;

  cx.save();
  cx.translate(CX, CY);
  cx.rotate(state.rot*Math.PI/180);

  // RUOTE
  cx.fillStyle = COLORS.rubber;
  // asse anteriore
  cx.beginPath(); cx.ellipse(-axOffset, -bodyW/2 - wheelW/2, wheelDia/2, wheelDia/2, 0, 0, Math.PI*2); cx.fill();
  cx.beginPath(); cx.ellipse(-axOffset,  bodyW/2 + wheelW/2, wheelDia/2, wheelDia/2, 0, 0, Math.PI*2); cx.fill();
  // asse posteriore
  cx.beginPath(); cx.ellipse( axOffset, -bodyW/2 - wheelW/2, wheelDia/2, wheelDia/2, 0, 0, Math.PI*2); cx.fill();
  cx.beginPath(); cx.ellipse( axOffset,  bodyW/2 + wheelW/2, wheelDia/2, wheelDia/2, 0, 0, Math.PI*2); cx.fill();

  // SCOCCA
  cx.fillStyle = '#fff';
  cx.strokeStyle = COLORS.chassis;
  cx.lineWidth = 2;
  const bodyX = -bodyL/2, bodyY = -bodyW/2;
  roundedRect(bodyX, bodyY, bodyL, bodyW, mm2px(6)); cx.fill(); cx.stroke();

  // muso e coda
  cx.beginPath(); cx.moveTo(bodyX, bodyY); cx.lineTo(bodyX - noseL, 0); cx.lineTo(bodyX, bodyY + bodyW); cx.closePath(); cx.fill(); cx.stroke();
  cx.beginPath(); cx.moveTo(bodyX + bodyL, bodyY); cx.lineTo(bodyX + bodyL + tailL, 0); cx.lineTo(bodyX + bodyL, bodyY + bodyW); cx.closePath(); cx.fill(); cx.stroke();

  // etichetta
  if(state.layers.labels){
    cx.fillStyle = COLORS.muted;
    cx.font = '12px system-ui';
    cx.fillText(`Vista ${state.view === 'top' ? 'Sopra' : 'Sotto'}`, -bodyL/2, -bodyW/2 - mm2px(12));
  }

  cx.restore();
}

function drawPlatesRollersDampersBrakesWeights(){
  const {cx:CX, cy:CY} = center();
  const L = mm2px(BASE.length);
  const W = mm2px(BASE.width);
  const WB = mm2px(BASE.wheelbase);
  const bodyL = L * 0.78;
  const bodyX = -bodyL/2, bodyY = -W/2;
  const axOffset = WB/2;

  cx.save();
  cx.translate(CX, CY);
  cx.rotate(state.rot*Math.PI/180);

  // PIATRE (FRP) — front/rear
  if(state.layers.plates){
    cx.fillStyle = COLORS.plate;
    const plateW = mm2px(14), plateL = mm2px(60);
    // front
    roundedRect(bodyX - mm2px(8) - plateL, -plateW/2, plateL, plateW, mm2px(3)); cx.globalAlpha=0.25; cx.fill(); cx.globalAlpha=1; 
    // rear
    roundedRect(bodyX + bodyL + mm2px(8), -plateW/2, plateL, plateW, mm2px(3)); cx.globalAlpha=0.25; cx.fill(); cx.globalAlpha=1;
  }

  // ROLLER 13/19mm
  if(state.layers.rollers){
    const r13 = mm2px(13/2), r19 = mm2px(19/2);
    cx.fillStyle = COLORS.roller;
    // anteriori: estremità piastra front
    cx.beginPath(); cx.arc(bodyX - mm2px(8) - mm2px(60) + mm2px(6), -W*0.36, r19, 0, Math.PI*2); cx.fill();
    cx.beginPath(); cx.arc(bodyX - mm2px(8) - mm2px(60) + mm2px(6),  W*0.36, r19, 0, Math.PI*2); cx.fill();
    // posteriori: estremità piastra rear
    cx.beginPath(); cx.arc(bodyX + bodyL + mm2px(8) + mm2px(60) - mm2px(6), -W*0.36, r13, 0, Math.PI*2); cx.fill();
    cx.beginPath(); cx.arc(bodyX + bodyL + mm2px(8) + mm2px(60) - mm2px(6),  W*0.36, r13, 0, Math.PI*2); cx.fill();
  }

  // DAMPER (8g/12g) — più vicini al posteriore
  if(state.layers.dampers){
    cx.fillStyle = COLORS.damper;
    const dR = mm2px(6);
    cx.beginPath(); cx.arc(bodyX + bodyL*0.60, -W*0.15, dR, 0, Math.PI*2); cx.fill();
    cx.beginPath(); cx.arc(bodyX + bodyL*0.60,  W*0.15, dR, 0, Math.PI*2); cx.fill();
  }

  // FRENI (sotto) — rappresentati come barre in coda
  if(state.layers.brakes && state.view === 'bottom'){
    cx.fillStyle = COLORS.brake;
    cx.fillRect(bodyX + bodyL + mm2px(6), -mm2px(8), mm2px(30), mm2px(3));
    cx.fillRect(bodyX + bodyL + mm2px(6),  mm2px(5), mm2px(30), mm2px(3));
  }

  // PESI — distribuzione CG
  if(state.layers.weights){
    cx.fillStyle = COLORS.weight;
    cx.fillRect(bodyX + bodyL*0.25, -mm2px(6), mm2px(12), mm2px(4));
    cx.fillRect(bodyX + bodyL*0.35, -mm2px(6), mm2px(12), mm2px(4));
    cx.fillRect(bodyX + bodyL*0.45,  mm2px(2),  mm2px(12), mm2px(4));
  }

  // ETICHETTE
  if(state.layers.labels){
    cx.fillStyle = COLORS.muted; cx.font='12px system-ui';
    cx.fillText('Piastra front', bodyX - mm2px(75), -mm2px(14));
    cx.fillText('Piastra rear',  bodyX + bodyL + mm2px(10), -mm2px(14));
    cx.fillText('Roller 19mm',  bodyX - mm2px(58), -W*0.36 - mm2px(10));
    cx.fillText('Roller 13mm',  bodyX + bodyL + mm2px(36), -W*0.36 - mm2px(10));
    if(state.view==='bottom'){ cx.fillText('Freni (sotto)', bodyX + bodyL + mm2px(8), -mm2px(14)); }
    cx.fillText('Damper 8/12g', bodyX + bodyL*0.60 + mm2px(8), -W*0.15);
    cx.fillText('Pesi (CG)',    bodyX + bodyL*0.33, mm2px(18));
  }

  cx.restore();
}

function render(){
  cx.clearRect(0,0,cv.width,cv.height);
  if(state.layers.grid) drawGrid();
  drawChassis();
  drawPlatesRollersDampersBrakesWeights();
}

// === UI Binds ===
document.querySelectorAll('.chip[data-view]').forEach(b=>{
  b.onclick = ()=>{ document.querySelectorAll('.chip[data-view]').forEach(x=>x.classList.remove('active'));
    b.classList.add('active'); state.view = b.dataset.view; render();
  };
});
document.getElementById('rot').oninput = e => { state.rot = +e.target.value; document.getElementById('rotLabel').textContent = state.rot+'°'; render(); };
document.getElementById('scale').oninput = e => { state.scale = +e.target.value; document.getElementById('scaleLabel').textContent = Math.round(state.scale*100)+'%'; render(); };
document.querySelectorAll('.layer').forEach(ch=>{
  ch.onchange = ()=>{ state.layers[ch.dataset.layer] = ch.checked; render(); };
});
document.getElementById('reset').onclick = ()=>{ state.rot=0; state.scale=1; document.getElementById('rot').value=0; document.getElementById('rotLabel').textContent='0°'; document.getElementById('scale').value=1; document.getElementById('scaleLabel').textContent='100%'; render(); };
document.getElementById('export').onclick = ()=>{
  const a=document.createElement('a'); a.download='mini4wd_demo_tecnica.png'; a.href=cv.toDataURL('image/png'); a.click();
};

// prima render
render();
</script>
</body>
</html>
